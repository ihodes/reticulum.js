{
    "name": "doctor",
    "description": "describes a doctor's actions",
    "group": "techcare",
    "user": "techcare",
    "initialState": "offCall",

    "fsm": {
        "offCall": {
            "actions": {
                "event": [
                    ["ifEqTransitionTo", "goOnCall", "onCall"]
                ]
            }
        },
        "onCall": {
            "actions": {
                "event": [
                    ["ifEqTransitionTo", "goOffCall", "offCall"],
                    ["ifEqTransitionTo", "acceptVisit", "enRoute"]
                ]
            }
        },
        "enRoute": {
            "actions": {
                "event": [
                    ["ifGeoEvent", "proximal", ".geoloc", ".visit.location", "arrived"]
                ],
                "enter": [
                    ["startContinuousMessage", ".visit.patientId",
                     "doctorLocation", ".geoloc"]
                ]
            }
        },
        "arrived": {
            "actions": {
                "event": [
                    ["ifEqTransitionTo", "done", "done"]
                ],
                "enter": [
                    ["stopContinuousMessage", ".visit.patientId",
                     "doctorLocation"],
                    ["message", ".visit.patientId", "doctorArrived"]
                ],
                "exit": [
                    ["message", ".visit.patientId", "treatmentDone"]
                ]
            }
        },
        "done": {
            "actions": {
                "event": [
                    ["ifEqTransitionTo", "feedbackSent", "onCall"]
                ],
                "exit":  [
                    ["messageBus", "doctorFeedback", "doctorId::.id", "patientId::.visit.patientId"],
                    ["clear", ".visit"]
                ]
            }
        }
    }
}
